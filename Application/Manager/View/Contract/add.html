<html>
<head></head>
<body>
<extend name="Public/base" />
<block name="main">
    <link rel="stylesheet" href="__PUBLIC__/Static/datetimepicker/css/datetimepicker.css" />
    <div class="row-fluid">
        <div class="span12">
            <div class="widget-box">
                <!--选项卡-->
                <ul class="nav nav-tabs" id="myTab">
                    <li><a href="#home">主协议</a></li>
                    <li><a href="#info">附属协议</a></li>
                </ul>
                <form class="form-horizontal" method="" action="{:U('Contract/doAdd')}" autocomplete="off">
                    <input type="hidden" name="model" value="Contract" />
                    <input type="hidden" name="contract_id" value="{$row['id']}" />
                    <div class="tab-content">
                        <div class="tab-pane" id="home">
                            <div class="control-group">
                                <label class="control-label">协议编号</label>
                                <div class="controls">
                                    <input type="text" name="agreement_number" value="{$row['agreement_number']}" disabled=""/>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">协议名称</label>
                                <div class="controls">
                                    <input type="text" name="agreement_name" value="{$row['agreement_name']}" disabled="" />
                                </div>
                            </div>

                            <div class="control-group">
                                <label class="control-label">甲方名称</label>
                                <div class="controls">
                                    <input type="text" name="first_name" value="{$row['first_name']}" disabled="" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">甲方公司地址</label>
                                <div class="controls">
                                    <input type="text" name="first_address" value="{$row['first_address']}" disabled="" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">甲方联系人</label>
                                <div class="controls">
                                    <input type="text" name="first_linkman" value="{$row['first_linkman']}" disabled="" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">甲方联系方式</label>
                                <div class="controls">
                                    <input type="text" name="first_contact" value="{$row['first_contact']}" disabled="" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">甲方电子邮箱</label>
                                <div class="controls">
                                    <input type="text" name="first_e_mail" value="{$row['first_e_mail']}" disabled="" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">乙方名称</label>
                                <div class="controls">
                                    <input type="text" name="party_name" value="{$row['party_name']}" disabled="" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">乙方公司地址</label>
                                <div class="controls">
                                    <input type="text" name="party_address" value="{$row['party_address']}" disabled="" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">乙方联系人</label>
                                <div class="controls">
                                    <input type="text" name="party_linkman" value="{$row['party_linkman']}" disabled="" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">乙方联系方式</label>
                                <div class="controls">
                                    <input type="text" name="party_contact" value="{$row['party_contact']}" disabled="" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">乙方电子邮箱</label>
                                <div class="controls">
                                    <input type="text" name="party_e_mail" value="{$row['party_e_mail']}" disabled="" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">开始时间</label>
                                <div class="controls">
                                    <input type="text" name="start_time" value="{$row['start_time']|date='Y-m-d H:i',###}" class="form_datetime input-sm" placeholder="开始时间" disabled="" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">结束时间</label>
                                <div class="controls">
                                    <input type="text" name="end_time" value="{$row['end_time']|date='Y-m-d H:i',###}" class="form_datetime input-sm" placeholder="结束时间" disabled="" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">电子协议</label>
                                <div class="controls">
                                    <foreach name="row['contract_img']" item="v">
                                        <a href="__ROOT__{$v['path']}"><img src="__ROOT__{$v['path']}" alt="" width="200" /> &nbsp;&nbsp;</a>
                                    </foreach>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="info">
                            <div class="control-group">
                                <label class="control-label">补充协议编号</label>
                                <div class="controls">
                                    <input type="number" name="agreement_number" value=""/>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">补充协议名称</label>
                                <div class="controls">
                                    <input type="text" name="agreement_name" value=""/>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">协议类型</label>
                                <div class="controls">
                                    <select class="types" name="types">
                                        <option value="0" selected> --附属协议类型-- </option>
                                        <option value="1"> 费用单 </option>
                                        <option value="2"> 价格单 </option>
                                        <option value="3"> 调价单 </option>
                                    </select>
                                </div>
                            </div>
                            <div class="cost" style="display: none;">
                                <div class="control-group">
                                    <label class="control-label">平台服务费最终总计</label>
                                    <div class="controls">
                                        <input type="number" min="0" step="0.01" name="serve_sum" value="{$row['serve_sum']}" />
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">节庆费最终总计填写金额</label>
                                    <div class="controls">
                                        <input type="number" min="0" step="0.01" name="festival_sum" value="{$row['festival_sum']}" />
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">保证金最终总计填写金额</label>
                                    <div class="controls">
                                        <input type="number" min="0" step="0.01" name="deposit_sum" value="{$row['deposit_sum']}" />
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">签署日期</label>
                                    <div class="controls">
                                        <input type="text" name="create_time1" value="" class="form_datetime input-sm" placeholder="签署日期">
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">供应商签署人</label>
                                    <div class="controls">
                                        <input type="text" name="name1" value="" />
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">合同图片</label>
                                    <div class="controls">
                                        {:hook('upload',array('is_first'=>1,'unique_sign'=>'contract1','queue_limit'=>10,'field_name'=>'contracts1','field_value'=>'','save_path'=>'Contract'))}
                                    </div>
                                </div>
                            </div>
                            <div class="price" style="display: none;">
                                <div class="control-group">
                                    <label class="control-label">商品入驻意见</label>
                                    <div class="controls">
                                        <textarea name="goods_opinion">{$row['goods_opinion']}</textarea>
                                        <span class="help-block">商品入驻意见</span>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">签署日期</label>
                                    <div class="controls">
                                        <input type="text" name="create_time2" value="" class="form_datetime input-sm" placeholder="开始时间">
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">供应商签署人</label>
                                    <div class="controls">
                                        <input type="text" name="name2" value=""/>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">合同图片</label>
                                    <div class="controls">
                                        {:hook('upload',array('is_first'=>2,'unique_sign'=>'contract2','queue_limit'=>10,'field_name'=>'contract2','field_value'=>$row['contract'],'save_path'=>'Contract'))}
                                    </div>
                                </div>
                            </div>
                            <div class="adjust" style="display: none;">
                                <div class="control-group">
                                    <label class="control-label">调价类型</label>
                                    <div class="controls">
                                        <select class="type" name="type">
                                            <option value="0" selected> --调价类型-- </option>
                                            <option value="1"> 临时调价 </option>
                                            <option value="2"> 永久调价 </option>
                                        </select>
                                    </div>
                                </div>

                                <div class="time" style="display: none;">
                                    <div class="control-group">
                                        <label class="control-label">开始日期</label>
                                        <div class="controls">
                                            <input type="text" name="start_time" value="" class="form_datetime input-sm" placeholder="开始时间">
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label">结束日期</label>
                                        <div class="controls">
                                            <input type="text" name="end_time" value="" class="form_datetime input-sm" placeholder="开始时间">
                                        </div>
                                    </div>

                                </div>
                                <div class="control-group">
                                    <label class="control-label">签署日期</label>
                                    <div class="controls">
                                        <input type="text" name="create_time3" value="" class="form_datetime input-sm" placeholder="开始时间">
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">供应商签署人</label>
                                    <div class="controls">
                                        <input type="text" name="name3" value="{$row['name']}" />
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">商品调价意见</label>
                                    <div class="controls">
                                        <textarea name="adjustment_opinion">{$row['adjustment_opinion']}</textarea>
                                        <!--<input type="text" name="goods_opinion" value="{$row['goods_opinion']}">-->
                                        <span class="help-block">商品调价意见</span>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">合同图片</label>
                                    <div class="controls">
                                        {:hook('upload',array('is_first'=>3,'unique_sign'=>'contract3','queue_limit'=>10,'field_name'=>'contract3','field_value'=>$row['contract'],'save_path'=>'Contract'))}
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button class="btn" onclick="javascript:history.back(-1);return false;">返 回</button>
                                <button class="btn btn-info ajax-post no-refresh" type="submit" id="n " target-form="form-horizontal">保 存</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <script type="text/javascript" src="__STATIC__/datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
        <script type="text/javascript" src="__STATIC__/datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
        <script>
            $('.form_datetime').datetimepicker({
                format: 'yyyy-mm-dd',
                minView: "month",
                language:"zh-CN",
                autoclose:true
            });
        </script>
        <script>
            $('.goods').change(function(){
                var goods_id = $(this).val();
                $.post("{:U('Contract/ajaxGoods')}",{goods_id:goods_id},function(data){
                    $('.goods_code').attr('value',data.goods_code);
                    $('.market_price').attr('value',data.market_price);
                    $('.shop_price').attr('value',data.shop_price);
                    $('.settlement_price').attr('value',data.settlement_price);
                });
            })
            $('.type').change(function(){
                var type = $(this).val();
                if(type == 2){
                    $('.time').hide();
                }else {
                    $('.time').show();
                }
            })
            $('.types').change(function(){
                var types = $(this).val();
                if(types == 1){
                    $('.cost').show();
                    $('.price').hide();
                    $('.adjust').hide();
                }
                if(types == 2){
                    $('.cost').hide();
                    $('.price').show();
                    $('.adjust').hide();
                }
                if(types == 3){
                    $('.cost').hide();
                    $('.price').hide();
                    $('.adjust').show();
                }
            })

            $(function () {
                $('#myTab a:first').tab('show');
            })

            $('#myTab a').click(function (e){
                e.preventDefault();
                $(this).tab('show');
            })
            //拒绝填写理由
            $('#refuse').click(function(){
                if($(this).attr('checked')){
                    $('#refuse-text').show();
                }
            })
            $('.no-refuse').click(function(){
                $('#refuse-text').hide();
            })
        </script>
    </div>
</block>
</body>
</html>